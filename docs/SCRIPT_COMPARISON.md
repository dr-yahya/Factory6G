# Simulation Scripts Comparison

This document explains the differences between the main simulation scripts in the Factory6G project.

## Overview

| Script | Purpose | Key Features | Use Case |
|--------|---------|--------------|----------|
| `main.py` | **General-purpose simulation runner** | Full CLI, flexible configuration, scenario presets | Standard simulations with custom parameters |
| `scripts/run_6g_simulation.py` | **6G-compliant parameter simulation** | Memory management, baseline comparison, detailed metrics | Production runs with max parameters |
| `scripts/compare_estimators.py` | **Channel estimator comparison** | Multi-estimator testing, comparison plots | Evaluating different channel estimation methods |
| `scripts/find_max_params.py` | **Parameter limit finder** | Incremental testing, binary search, memory limits | Finding maximum system parameters before OOM |

---

## 1. `main.py` - General Simulation Runner

**Location:** `main.py` (project root)

**Purpose:** Main entry point for running simulations with flexible configuration options.

### Key Features:
- ✅ Comprehensive command-line interface (CLI)
- ✅ Supports multiple scenarios (UMi, UMa, RMa)
- ✅ Multiple channel estimators (ls, ls_nn, ls_lin, neural)
- ✅ Scenario presets support
- ✅ Resource manager integration
- ✅ Basic BER/BLER plots
- ✅ Results summary tables

### Typical Usage:
```bash
# Default simulation
python main.py

# Custom scenario and Eb/No range
python main.py --scenario uma --ebno-min -5 --ebno-max 15 --ebno-step 2

# Multiple estimators
python main.py --estimator ls_nn neural --neural-weights artifacts/model.h5
```

### Output:
- JSON results file
- Basic BER/BLER plots (PNG + PDF)
- Console summary tables

### When to Use:
- Quick simulations with custom parameters
- Testing different scenarios
- Comparing perfect vs imperfect CSI
- General system evaluation

---

## 2. `scripts/run_6g_simulation.py` - 6G-Compliant Simulation

**Location:** `scripts/run_6g_simulation.py`

**Purpose:** Runs simulations with maximum 6G-compliant parameters, includes memory management and detailed analysis.

### Key Features:
- ✅ Loads parameters from `max_params_config.json` (from `find_max_params.py`)
- ✅ **Memory management** (estimates, monitors, optimizes batch size)
- ✅ **Baseline comparison** (3GPP Release 19)
- ✅ **Detailed metrics** (per-stream and overall)
- ✅ **Matrix exports** (NumPy arrays for all metrics)
- ✅ **Comprehensive plots** (per-stream, overall, comparison plots)
- ✅ GPU/CPU detection and configuration

### Typical Usage:
```bash
# Run with max parameters (requires max_params_config.json)
python scripts/run_6g_simulation.py
```

### Output:
- JSON results file
- **Matrices directory** (`.npy` files for all metrics)
- **Plots directory** (per-stream, overall, comparison plots)
- Baseline comparison plots (6G vs 3GPP Release 19)

### When to Use:
- Production runs with maximum system parameters
- Generating detailed analysis and publication-quality plots
- Comparing against baseline results
- Exporting data for further analysis (NumPy matrices)

### Dependencies:
- Requires `results/max_params_config.json` (generated by `find_max_params.py`)

---

## 3. `scripts/compare_estimators.py` - Channel Estimator Comparison

**Location:** `scripts/compare_estimators.py`

**Purpose:** Systematically compares different channel estimation methods side-by-side.

### Key Features:
- ✅ Tests multiple estimators in one run
- ✅ **Comparison visualizations** (BER, BLER, NMSE, SINR, decoder iterations, EVM)
- ✅ **Comprehensive dashboard** (all metrics in one figure)
- ✅ Side-by-side comparison plots
- ✅ Summary tables comparing all estimators

### Available Estimators:
- `ls_nn`: Least Squares with Nearest Neighbor interpolation
- `ls_lin`: Least Squares with Linear interpolation
- `neural`: Neural network-based estimator
- `ls_smooth`: Smoothed LS (2D smoothing)
- `ls_temporal`: Temporal EMA estimator

### Typical Usage:
```bash
# Compare all estimators
python scripts/compare_estimators.py

# Compare specific estimators
python scripts/compare_estimators.py --estimators ls_nn neural

# Custom Eb/No range
python scripts/compare_estimators.py --ebno-min -3 --ebno-max 9 --ebno-step 3
```

### Output:
- Comparison JSON file
- **BER/BLER comparison plots**
- **NMSE/SINR comparison plots**
- **Decoder iterations/EVM plots**
- **Comprehensive dashboard** (all metrics)
- Summary comparison table

### When to Use:
- Evaluating which channel estimator performs best
- Research/paper comparisons
- Understanding trade-offs between estimators
- Performance benchmarking

---

## 4. `scripts/find_max_params.py` - Parameter Limit Finder

**Location:** `scripts/find_max_params.py`

**Purpose:** Finds the maximum system parameters (batch size, FFT size, antennas, etc.) before the system runs out of memory.

### Key Features:
- ✅ **Incremental parameter testing**
- ✅ **Binary search** for precise limits
- ✅ **Memory estimation**
- ✅ **6G 3GPP compliance** (respects 6G parameter bounds)
- ✅ Saves last working configuration
- ✅ Test history tracking

### Parameters Tested:
- `batch_size`: Batch size for simulation
- `fft_size`: FFT size (must be power of 2, 512-16384 for 6G)
- `num_bs_ant`: Base station antennas (up to 4096 for 6G massive MIMO)
- `num_ut`: User terminals (up to 256 for 6G)
- `num_ut_ant`: UT antennas (up to 8 for 6G)
- `num_ofdm_symbols`: OFDM symbols (typically 14, up to 28)

### Typical Usage:
```bash
# Find max parameters (balanced strategy - increases all)
python scripts/find_max_params.py

# Individual strategy (one parameter at a time)
python scripts/find_max_params.py --strategy individual

# Custom starting values
python scripts/find_max_params.py --start-batch-size 16 --start-fft-size 1024
```

### Output:
- `results/max_params.json` (full results with history)
- `results/max_params_config.json` (simple config file for `run_6g_simulation.py`)

### When to Use:
- Before running large-scale simulations
- Finding system limits on your hardware
- Optimizing batch size for your GPU/memory
- Generating config for `run_6g_simulation.py`

### Strategy Options:
- **`balanced`**: Increases all parameters proportionally (faster, less precise)
- **`individual`**: Tests one parameter at a time (slower, more precise)

---

## Workflow Recommendations

### Typical Workflow:

1. **Find System Limits:**
   ```bash
   python scripts/find_max_params.py
   ```
   This generates `results/max_params_config.json`

2. **Run Production Simulation:**
   ```bash
   python scripts/run_6g_simulation.py
   ```
   Uses the max parameters and generates detailed results

3. **Compare Estimators (if needed):**
   ```bash
   python scripts/compare_estimators.py --estimators ls_nn neural
   ```

4. **Quick Tests/Experiments:**
   ```bash
   python main.py --scenario uma --ebno-min 0 --ebno-max 10
   ```

---

## Quick Decision Tree

```
Need to find system limits?
├─ Yes → Use find_max_params.py
└─ No → Continue...

Need detailed metrics & baseline comparison?
├─ Yes → Use run_6g_simulation.py (requires max_params_config.json)
└─ No → Continue...

Need to compare multiple estimators?
├─ Yes → Use compare_estimators.py
└─ No → Use main.py
```

---

## Summary Table

| Feature | main.py | run_6g_simulation.py | compare_estimators.py | find_max_params.py |
|---------|---------|----------------------|----------------------|-------------------|
| **CLI Options** | ✅ Extensive | ❌ Minimal (hardcoded) | ✅ Moderate | ✅ Moderate |
| **Memory Management** | ❌ Basic | ✅ Advanced | ❌ Basic | ✅ Testing-focused |
| **Baseline Comparison** | ❌ | ✅ | ❌ | ❌ |
| **Matrix Export** | ❌ | ✅ | ❌ | ❌ |
| **Multiple Estimators** | ✅ (sequential) | ❌ | ✅ (parallel comparison) | ❌ |
| **Parameter Finding** | ❌ | ❌ | ❌ | ✅ |
| **Detailed Plots** | ❌ Basic | ✅ Comprehensive | ✅ Comparison-focused | ❌ |
| **Scenario Presets** | ✅ | ❌ | ❌ | ❌ |
| **Resource Manager** | ✅ | ❌ | ❌ | ❌ |

---

## Code Organization

All scripts now use shared modules from `src/sim/`:
- `src/sim/metrics.py` - Metrics accumulation
- `src/sim/runner.py` - Core simulation logic
- `src/sim/plotting.py` - Plotting functions
- `src/sim/results.py` - Result saving/loading
- `src/utils/env.py` - Environment configuration

This ensures consistency and reduces code duplication.

